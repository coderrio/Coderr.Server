"use strict";var Griffin;(function(n){var t;(function(n){var t;(function(n){var u=function(){function n(){}return n.removeChildren=function(n){if(!n)throw new Error("Element not set: "+n);while(n.firstChild)n.removeChild(n.firstChild)},n.moveChildren=function(n,t){while(n.firstChild)t.appendChild(n.firstChild);n.parentElement?n.parentElement.removeChild(n):n.remove()},n.getIdentifier=function(n){var t,i,r;if(n.id)return n.id;if((t=n.getAttribute("name"),t!=null)||(t=n.getAttribute("data-name"),t!=null))return t;for(i="",r=0;r<n.attributes.length;r++)i=i+n.attributes[r].name+"="+n.attributes[r].value+",";return n.tagName+"["+i.substr(0,i.length-1)+"]"},n}(),t,i,r;n.ElemUtils=u;t=function(){function n(n){this.scope=typeof n=="undefined"?document:n}return n.prototype.click=function(n,t,i){var u=this.scope.querySelectorAll(n),r;if(u.length===0)throw new Error('Failed to bind "click" to selector "'+n+'", no elements found.');for(r=0;r<u.length;r++)u[r].addEventListener("click",t,i)},n.prototype.change=function(n,t,i){var u=this.scope.querySelectorAll(n),r;if(u.length===0)throw new Error('Failed to bind "change" to selector "'+n+'", no elements found.');for(r=0;r<u.length;r++)u[r].addEventListener("change",t,i)},n.prototype.keyUp=function(n,t,i){var u=this.scope.querySelectorAll(n),r;if(u.length===0)throw new Error('Failed to bind "keyup" to selector "'+n+'", no elements found.');for(r=0;r<u.length;r++)u[r].addEventListener("keyup",t,i)},n.prototype.keyDown=function(n,t,i){var u=this.scope.querySelectorAll(n),r;if(u.length===0)throw new Error('Failed to bind "keydown" to selector "'+n+'", no elements found.');for(r=0;r<u.length;r++)u[r].addEventListener("keydown",t,i)},n}();n.EventMapper=t;i=function(){function n(n){if(this.stack=[],typeof n=="string"){if(this.container=document.querySelector("#"+n+',[data-name="'+n+'"]'),!this.container)throw new Error("Failed to locate '"+n+"'.");}else this.container=n}return n.prototype.read=function(){for(var n,u,f,t,i={},r=0;r<this.container.childElementCount;r++){if(n=this.container.children[r],u=this.getName(n),!u){f=this.pullElement(n);f&&this.appendObject(i,f);continue}this.isCollection(n)?t=this.pullCollection(n):(t=this.pullElement(n),t=this.adjustCheckboxes(n,i,t));this.assignByName(u,i,t)}return i},n.prototype.pullCollection=function(n){for(var i,u,s,r,f=[],t={},e=[],o=0;o<n.childElementCount;o++){if(i=n.children[o],u=this.getName(i),!u){r=this.pullElement(i);this.isObjectEmpty(r)||(this.isObjectEmpty(t)||f.push(t),f.push(r),t={},e=[]);continue}if(s=i.getAttribute("type")==="checkbox"||i.getAttribute("type")==="radio",u!=="[]"&&e.indexOf(u)>=0&&!s&&(f.push(t),t={},e=[]),e.push(u),this.isCollection(i))r=this.pullCollection(i);else if(r=this.pullElement(i),r===null)continue;u==="[]"?f.push(r):this.assignByName(u,t,r)}return this.isObjectEmpty(t)||f.push(t),f},n.prototype.pullElement=function(n){var u,h,f,o,c,r,e,i,s,t;if(n.tagName=="SELECT")return(u=n,u.selectedIndex==-1)?null:(h=u.options[u.selectedIndex],this.processValue(h.value));if(n.childElementCount===0){if(n.tagName=="INPUT")return(f=n,o=n.getAttribute("type"),o==="radio"||o==="checkbox")?f.checked?this.processValue(f.value):null:this.processValue(f.value);if(n.tagName=="TEXTAREA")return c=n.value,this.processValue(c)}for(r={},e=0;e<n.childElementCount;e++){if(i=n.children[e],s=this.getName(i),!s){t=this.pullElement(i);this.isObjectEmpty(t)||this.appendObject(r,t);continue}if(this.isCollection(i))t=this.pullCollection(i);else if(t=this.pullElement(i),t=this.adjustCheckboxes(i,r,t),t===null)continue;this.assignByName(s,r,t)}return this.isObjectEmpty(r)?null:r},n.prototype.adjustCheckboxes=function(n,t,i){if(i!==null&&n.tagName==="INPUT"&&n.getAttribute("type")==="checkbox"){var u=this.getName(n),r=t[u];typeof r!="undefined"?r instanceof Array?(r.push(i),i=r):i=[r,i]:i=[i]}return i},n.prototype.processValue=function(n){if(isNaN(n)){if(n=="true")return!0;if(n=="false")return!1}else return parseInt(n,10);return n},n.prototype.assignByName=function(n,t,i){var e=n.split("."),r=t,u=t,f="";e.forEach(function(n){f=n;r.hasOwnProperty(n)||(r[n]={});u=r;r=r[n]});u[f]=i},n.prototype.appendObject=function(n,t){for(var i in t)n.hasOwnProperty(i)||(n[i]=t[i])},n.prototype.isObjectEmpty=function(n){for(var t in n)if(n.hasOwnProperty(t))return!1;return!0},n.prototype.getName=function(n){return n.getAttribute("name")||n.getAttribute("data-name")||n.getAttribute("data-collection")},n.prototype.isCollection=function(n){return n.hasAttribute("data-collection")},n}();n.FormReader=i;r=function(){function n(n){if(this.scope=typeof n=="undefined"?document:n,!this.scope)throw new Error("Failed to identify scope");}return n.prototype.one=function(n){var t,i,r;if(n.substr(0,1)==="#"){if(t=this.scope.querySelector(n),!t)throw new Error("Failed to find element '"+n+"'.");return t}if(n.match(/[\s\.\,\[]+/g)===null&&(i=this.scope.querySelector("[data-name='"+n+"'],[data-collection='"+n+"'],[name=\""+n+'"],#'+n),i))return i;if(r=this.scope.querySelector(n),!r)throw Error('Failed to find "'+n+'".');return r},n.prototype.all=function(n){for(var i=[],r=n.match("[s.,[]+").length===0?this.scope.querySelectorAll('[data-name="'+n+"\"],[data-collection='"+n+"'],[name=\""+n+'"],#'+n):this.scope.querySelectorAll(n),t=0;t<r.length;t++)i.push(r[t]);return i},n}();n.Selector=r})(t=n.Dom||(n.Dom={}))})(t=n.Yo||(n.Yo={}))})(Griffin||(Griffin={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.get=function(n,t,i){var u=this,r,f;i===void 0&&(i="application/json");r=new XMLHttpRequest;r.open("GET",n,!0);typeof this.cache[n]!="undefined"&&(f=this.cache[n],r.setRequestHeader("If-Modified-Since",f.modifiedAt));r.setRequestHeader("Content-Type",i);r.onload=function(){var f,e;r.status>=200&&r.status<400?(r.status===304?r.responseText=u.cache[n].content:(f=r.getResponseHeader("Last-Modified"),f&&(u.cache[n]={content:r.responseText,modifiedAt:f})),i==="application/json"&&(r.responseBody=JSON.parse(r.responseText),e=r,e.responseJson=JSON.parse(r.responseText)),t(r,!0)):t(r,!1)};r.onerror=function(){t(r,!1)};r.send()},n.post=function(t,i,r,u){if(!i)throw new Error("You must specify a body when using POST.");n.invokeRequest("POST",t,i,r,u)},n.put=function(t,i,r,u){if(!i)throw new Error("You must specify a body when using PUT.");n.invokeRequest("PUT",t,i,r,u)},n["delete"]=function(t,i,r){n.invokeRequest("DELETE",t,null,i,r)},n.invokeRequest=function(n,t,i,r,u){var f,e,o;if(!n)throw new Error("You must specify a HTTP verb");if(u&&u.userName&&!u.password)throw new Error("You must provide password when username has been specified.");if(f=new XMLHttpRequest,u&&u.userName?f.open(n,t,!0,u.userName,u.password):f.open(n,t,!0),e="application/json",u&&u.contentType&&(e=u.contentType),u&&u.headers)for(o in u.headers)f.setRequestHeader(o,u.headers[o]);f.onload=function(){var n,t;f.status>=200&&f.status<400?(n=f.getResponseHeader("content-type").toLocaleLowerCase(),n==="application/json"&&(f.responseBody=JSON.parse(f.responseText),t=f,t.responseJson=JSON.parse(f.responseText)),r(f,!0)):r(f,!1)};f.onerror=function(){r(f,!1)};typeof i!="undefined"&&i!==null?(f.setRequestHeader("Content-Type",e),e==="application/json"&&typeof i!="string"&&(i=JSON.stringify(i)),f.send(i)):f.send()},n}();t.cache={};t.useCaching=!0;n.Http=t})(t=n.Net||(n.Net={}))})(t=n.Yo||(n.Yo={}))}(Griffin||(Griffin={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i){this.route=n;this.handler=t;this.target=i;this.parts=[];this.parts=n.replace(/^\//,"").replace(/\/$/,"").split("/")}return n.prototype.isMatch=function(n){for(var i,r,u=n.url.split("/",10),t=0;t<this.parts.length;t++)if(i=this.parts[t],r=u[t],r!==undefined){if(i.charAt(0)===":")continue;else if(i!==r)return!1}else return i.charAt(0)!==":"?!1:!1;return!0},n.prototype.invoke=function(n){for(var t,u,f,e=n.url.split("/",10),r={},i=0;i<this.parts.length;i++)t=this.parts[i],u=e[i],u!=="undefined"?t.charAt(0)===":"&&(r[t.substr(1)]=u):t.charAt(0)===":"&&(r[t.substr(1)]=null);f={routeData:r,route:this};typeof this.target!="undefined"&&(f.target=this.target);this.handler.invoke(f)},n}(),i;n.Route=t;i=function(){function n(){this.routes=[]}return n.prototype.add=function(n,i,r){this.routes.push(new t(n,i,r))},n.prototype.addRoute=function(n){if(typeof n=="undefined")throw new Error("Route must be specified.");this.routes.push(n)},n.prototype.execute=function(n,t){var i,r,u;if(n.length&&(n=n.replace(/\/+/g,"/").replace(/^\/|\/($|\?)/,"").replace(/#.*$/,"")),i={url:n},typeof t!="undefined"){if(typeof t=="string"&&(i.targetElement=document.getElementById(t),!i.targetElement))throw new Error("Failed to identify '"+t+"'");i.targetElement=t}for(r=0;r<this.routes.length;r++)if(u=this.routes[r],u.isMatch(i))return u.invoke(i),!0;return console&&console.log&&console.log('Route not found for "'+n+'"'),!1},n}();n.Router=i})(t=n.Routing||(n.Routing={}))})(t=n.Yo||(n.Yo={}))}(Griffin||(Griffin={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var r=function(){function n(){this.name="BootstrapModal"}return n.prototype.assignOptions=function(){},n.prototype.attachViewModel=function(n){this.currentNode=new t(this.name);this.currentNode.attachViewModel(n)},n.prototype.setTitle=function(n){this.currentNode.setTitle(n)},n.prototype.render=function(n){this.currentNode.render(n);this.currentNode=null},n}(),t,i;n.BootstrapModalViewTarget=r;t=function(){function n(n){this.name=n;this.node=document.createElement("div");this.node.setAttribute("id",this.name);this.node.setAttribute("class","modal fade view-target");this.node.setAttribute("role","dialog");document.body.appendChild(this.node);this.node.innerHTML='\r\n  <div class="modal-dialog">\r\n\r\n    <div class="modal-content">\r\n      <div class="modal-header">\r\n        <button type="button" class="close" data-dismiss="modal">&times;<\/button>\r\n        <h4 class="modal-title"><\/h4>\r\n      <\/div>\r\n      <div class="modal-body">\r\n        \r\n      <\/div>\r\n      <div class="modal-footer">\r\n        <button type="button" class="btn btn-default" data-dismiss="modal">Close<\/button>\r\n      <\/div>\r\n    <\/div>\r\n\r\n  <\/div>\r\n'}return n.prototype.prepare=function(n){for(var i=this.node.querySelector(".modal-body"),t;i.firstChild;)i.removeChild(i.firstChild);for(t=this.node.querySelector(".modal-footer");t.firstChild;)t.removeChild(t.firstChild);n&&n.buttons&&n.buttons.forEach(function(n){var r=document.createElement("button");n.className?r.setAttribute("class","btn "+n.className):r.setAttribute("class","btn btn-default");r.setAttribute("data-dismiss","modal");r.innerText=n.title;r.addEventListener("click",function(){n.callback(i.firstElementChild)});t.appendChild(r)})},n.prototype.attachViewModel=function(n){this.node.querySelector(".modal-body").appendChild(n)},n.prototype.setTitle=function(n){this.node.querySelector(".modal-title").innerText=n},n.prototype.render=function(n){var f=this,i,e,t,r,u;this.node.querySelector(".modal-body").appendChild(n);i=this.node.querySelector(".modal-footer");this.modal=$(this.node).modal();e=this.modal;$(this.modal).on("hidden.bs.modal",function(){f.modal.modal("hide").data("bs.modal",null);f.node.parentElement.removeChild(f.node)});if(t=n.querySelectorAll('button,input[type="submit"],input[type="button"]'),t.length>0){while(i.firstChild)i.removeChild(i.firstChild);for(r=0;r<t.length;r++)u=t[r],u.className+=" btn",u.addEventListener("click",function(n){this.modal("hide");(n.tagName==="input"&&n.type!=="submit"||n.hasAttribute("data-dismiss"))&&window.history.go(-1)}.bind(this,u)),i.appendChild(t[r]);t.length===1?t[0].className+=" btn-primary":(t[0].className+=" btn-primary",t[t.length-1].className+=" btn-cancel")}this.modal.modal("show")},n}();i=function(){function n(n){if(this.name="",typeof n=="string"){if(this.container=document.getElementById(n.substr(1)),!this.container)throw'Could not locate "'+n+'"';}else this.container=n;this.name=this.container.id}return n.prototype.assignOptions=function(){},n.prototype.attachViewModel=function(n){this.container.appendChild(n)},n.prototype.setTitle=function(){},n.prototype.render=function(n){while(this.container.firstElementChild&&this.container.firstElementChild.nextElementSibling!=null)this.container.removeChild(this.container.firstElementChild);this.container.innerHTML="";this.container.appendChild(n)},n}();n.ElementViewTarget=i})(t=n.ViewTargets||(n.ViewTargets={}))})(t=n.Routing||(n.Routing={}))})(t=n.Yo||(n.Yo={}))}(Griffin||(Griffin={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.getConstructor=function(n,t){var u=t.split("."),i=window[n]||this[n],r,o,s,f,e;if(typeof i=="undefined")throw new Error('Failed to load application namespace "'+n+'". Have a view model been loaded successfully?');for(r=0,o=u.length;r<o;r++){if(i.hasOwnProperty(u[r])){i=i[u[r]];continue}s=u[r].toLowerCase();f=void 0;for(e in i)i.hasOwnProperty(e)&&e.toLowerCase()===s&&(f=e);if(typeof f=="undefined")throw new Error('Could not find "'+u[r]+'" from viewModel name, complete name: "'+n+"."+t+'".');i=i[f]}if(typeof i!="function")throw new Error("Could not find view model "+t);return i},n}();n.ClassFactory=t})(t=n.ViewModels||(n.ViewModels={}))})(t=n.Spa||(n.Spa={}))})(t=n.Yo||(n.Yo={}))}(Griffin||(Griffin={})),function(n){var t;(function(t){var i;(function(i){var h=t.Routing,c=t.Routing.ViewTargets,l=t.Spa.ViewModels,u=t.Dom,o=t.Net,r=function(){function n(){}return n}(),f,e,s;r.applicationScope={};i.Config=r;f=function(){function t(n,t){if(this.section=n,!t)throw new Error("applicationName must be specified");if(!n)throw new Error("section must be specified");this.applicationName=t}return t.replaceAll=function(n,t,i){t=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");var r=new RegExp(t,"g");return n.replace(r,i)},t.prototype.applyRouteDataToLinks=function(n,i){for(var r,e,u,s,h,o=n.querySelectorAll("a"),f=0;f<o.length;f++)if(r=o[f],e=r.href.indexOf("#"),e!==-1&&r.href.substr(e+1,1)==="/")for(u in i)i.hasOwnProperty(u)&&(s=t.replaceAll(r.href,":"+u,i[u]),h=r.href,r.href=t.replaceAll(r.href,":"+u,i[u]))},t.prototype.moveNavigationToMain=function(n,t){for(var e,h,o=n.querySelectorAll("[data-navigation]"),r=0;r<o.length;r++){var i=o[r],s=i.getAttribute("data-navigation"),f=document.getElementById(s);if(!f)throw new Error("Failed to find target element '"+s+"' for navigation '"+i.innerHTML+"'");if(e=i.getAttribute("data-if"),h=!e||!this.evalInContext(e,t),!h){i.parentNode.removeChild(i);continue}this.removeConditions(i,t);u.ElemUtils.removeChildren(f);u.ElemUtils.moveChildren(i,f)}},t.prototype.removeConditions=function(n,t){for(var i,u,f,r=0;r<n.childElementCount;r++)if((i=n.children[r],i.hasAttribute("data-if"))&&(u=i.getAttribute("data-if"),f=this.evalInContext(u,t),!f)){i.parentNode.removeChild(i);continue}},t.prototype.evalInContext=function(n,t){var i=function(n){return eval("with (this) { "+n+"}")};return i.call(t,n)},t.prototype.isIE=function(){var n=navigator.userAgent.toLowerCase();return n.indexOf("msie")!=-1?parseInt(n.split("msie")[1]):!1},t.prototype.invoke=function(t){var i=this,f=this;this.ensureResources(function(){var o=document.createElement("div"),h,c,s,l,a;o.className="ViewContainer";o.innerHTML=i.html;h=document.createElement("script");h.setAttribute("type","text/javascript");h.setAttribute("data-tag","viewModel");t.target.attachViewModel(h);i.isIE()<=9?h.text=i.viewModelScript:h.innerHTML=i.viewModelScript;c=i.section.replace(/\//g,".")+"ViewModel";i.viewModel=r.viewModelFactory.create(i.applicationName,c);s=i.viewModel;s.hasOwnProperty("getTargetOptions")?(l=s.hasTargetOptions(),t.target.assignOptions(l)):t.target.assignOptions({});i.applyRouteDataToLinks(o,t.routeData);i.moveNavigationToMain(o,{model:i.viewModel,ctx:t});a={routeData:t.routeData,viewContainer:o,render:function(t,i){var r=new n.Yo.Views.ViewRenderer(o);r.render(t,i)},readForm:function(n){var t=new u.FormReader(n);return t.read()},renderPartial:function(t,i,r){var f=new u.Selector(o),e=f.one(t),s=new n.Yo.Views.ViewRenderer(e);s.render(i,r)},resolve:function(){var c,v,u,l,a,i,r,n,h;for(document.title=s.getTitle(),t.target.setTitle(s.getTitle()),t.target.render(o),c=o.getElementsByTagName("script"),v=new e,u=0;u<c.length;u++)v.loadTags(c[u]);for(l=o.querySelectorAll("[data-if]"),i=0;i<l.length;i++)(r=l[i],n=r.getAttribute("data-if"),n.substr(0,3)=="vm."||n.substr(0,6)=="model."||n.substr(0,4)=="ctx.")&&(h=f.evalInContext(n,{model:s,ctx:t,vm:s}),h||r.parentNode.removeChild(r));for(a=o.querySelectorAll("[data-unless]"),i=0;i<a.length;i++)(r=a[i],n=r.getAttribute("data-unless"),n.substr(0,3)=="vm."||n.substr(0,6)=="model."||n.substr(0,4)=="ctx.")&&(h=f.evalInContext(n,{ctx:t,vm:s}),h||r.parentNode.removeChild(r))},reject:function(){},handle:new u.EventMapper(o),select:new u.Selector(o),applicationScope:r.applicationScope};i.viewModel.activate(a)})},t.prototype.ensureResources=function(n){var u=this,i=!0,f=this,t;typeof this.html=="undefined"&&(t=r.resourceLocator.getHtml(this.section),o.Http.get(t,function(t,r){if(r)f.html=t.responseText,u.doStep(n);else throw new Error(t.responseText);i=!1},"text/html"));typeof this.viewModel=="undefined"&&(t=r.resourceLocator.getScript(this.section),o.Http.get(t,function(t,i){if(i)f.viewModelScript=t.responseText,u.doStep(n);else throw new Error(t.responseText);},"text/javascript"),i=!1);i&&this.doStep(n)},t.prototype.doStep=function(n){typeof this.html!="undefined"&&typeof this.viewModelScript!="undefined"&&n()},t}();i.RouteRunner=f;e=function(){function n(t){t===void 0&&(t=document.head);this.pendingScripts=[];this.embeddedScripts=[];this.container=t;n.dummyScriptNode||(n.dummyScriptNode=document.createElement("script"))}return n.prototype.stateChange=function(){if(this.pendingScripts.length===0){console&&console.log&&console.log("Got ready state for a non existent script: ",this);return}for(var n=this.pendingScripts[0];n&&n.readyState==="loaded";)n.onreadystatechange=null,this.container.appendChild(n),this.pendingScripts.shift(),n=this.pendingScripts[0];this.pendingScripts.length===0&&this.runEmbeddedScripts()},n.prototype.loadSources=function(n){if(n instanceof Array)for(var t=0;t<n.length;t++)this.loadSource(n[t]);else this.loadSource(n)},n.prototype.loadTags=function(n){if(n instanceof Array)for(var t=0;t<n.length;t++)this.loadElement(n[t]);else this.loadElement(n);this.pendingScripts.length===0&&this.runEmbeddedScripts()},n.prototype.loadSource=function(t){var f=this,i,u,r;"async"in n.dummyScriptNode?(i=document.createElement("script"),i.async=!1,this.pendingScripts.push(i),i.addEventListener("load",function(){return f.onScriptLoaded(i)}),i.src=t,this.container.appendChild(i)):n.dummyScriptNode.readyState?(u=document.createElement("script"),this.pendingScripts.push(u),u.onreadystatechange=this.stateChange,u.src=t):(r=document.createElement("script"),r.defer=!0,this.pendingScripts.push(r),r.addEventListener("load",function(){return f.onScriptLoaded(r)}),r.src=t,this.container.appendChild(r))},n.prototype.loadElement=function(n){if(n.src){this.loadSource(n.src);return}var t=document.createElement("script");t.text=n.text;this.embeddedScripts.push(t)},n.prototype.onScriptLoaded=function(){this.pendingScripts.pop();this.pendingScripts.length===0&&this.runEmbeddedScripts()},n.prototype.runEmbeddedScripts=function(){for(var n=0;n<this.embeddedScripts.length;n++)this.container.appendChild(this.embeddedScripts[n]);while(this.embeddedScripts.length>0)this.embeddedScripts.pop()},n}();i.ScriptLoader=e;s=function(){function t(n){this.applicationName=n;this.router=new h.Router;this.basePath="";this.applicationScope={};this.viewTargets=[];this.basePath=window.location.pathname;this.defaultViewTarget=new c.ElementViewTarget("#YoView")}return t.prototype.addTarget=function(t,i){var r,u;if(typeof i=="string"){if(r=i,r.substr(0,1)!="#")throw new Error("Element id must start with #.");i=new n.Yo.Routing.ViewTargets.ElementViewTarget(r)}u=i;u.name=t;console.log("adding view target");this.viewTargets.push(u)},t.prototype.navigate=function(n,t){this.router.execute.apply(this.applicationScope,[n,t])},t.prototype.mapRoute=function(n,t,i){var e=new f(t,this.applicationName),u,r;if(i){for(r=0;r<this.viewTargets.length;r++)if(this.viewTargets[r].name===i){u=this.viewTargets[r];break}if(!u)throw'Could not find view target "'+i+'".';}else u=this.defaultViewTarget;this.router.add(n,e,u)},t.prototype.run=function(){var t=this,n=window.location.hash.substring(1);n.substr(0,1)==="!"&&(n=n.substr(1));window.addEventListener("hashchange",function(){var i=window.location.hash,n;(i||(i="#/"),i.substr(1,1)==="/")&&(n=i.substr(2),n.substr(0,1)==="!"&&(n=n.substr(1)),t.router.execute(n))});this.router.execute(n)},t.prototype.mapFunctionToRouteData=function(n){var t=n.toString().match(/^\s*function\s+(?:\w*\s*)?\((.*?)\)/),i=n[1].trim().split(/\s*,\s*/)},t}();i.SpaEngine=s;r.resourceLocator={getHtml:function(n){var t=window.location.pathname,i;return window.location.pathname.indexOf(".")>-1&&(i=window.location.pathname.lastIndexOf("/"),t=window.location.pathname.substr(0,i)),t.substring(-1,1)==="/"&&(t=t.substring(0,t.length-1)),t+("/Views/"+n+".html")},getScript:function(n){var t=window.location.pathname,i;return window.location.pathname.indexOf(".")>-1&&(i=window.location.pathname.lastIndexOf("/"),t=window.location.pathname.substr(0,i)),t.substring(-1,1)==="/"&&(t=t.substring(0,t.length-1)),t+("/ViewModels/"+n+"ViewModel.js")}};r.viewModelFactory={create:function(n,t){var i=l.ClassFactory.getConstructor(n,t);return new i(r.applicationScope)}}})(i=t.Spa||(t.Spa={}))})(t=n.Yo||(n.Yo={}))}(Griffin||(Griffin={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){if(this.lineage=[],this.dtoStack=[],this.directives=[],typeof n=="string"){if(this.container=n.substr(0,1)==="#"?document.getElementById(n.substr(1)):document.querySelector("[data-name='"+n+"'],[data-collection='"+n+"'],#"+n+',[name="'+n+'"]'),!this.container)throw new Error("Failed to locate '"+n+"'.");}else this.container=n}return n.prototype.register=function(n){this.directives.push(n)},n.registerGlobal=function(t){n.globalValueDirectives.push(t)},n.prototype.render=function(n,t){n===void 0&&(n={});t===void 0&&(t={});this.dtoStack.push(n);n instanceof Array?this.renderCollection(this.container,n,t):this.renderElement(this.container,n,t)},n.prototype.renderElement=function(n,t,i){var s,a,c,h,e,l,f,r,u,o,v,y,p,w;if(i===void 0&&(i={}),s=this.getName(n),s&&this.log("renderElement",this.getName(n)),s&&n.tagName==="SELECT"){for(a=n,c=0;c<a.options.length;c++)if(h=a.options[c],h.value===t||h.label===t){this.log("setting option "+h.label+" to selected");h.selected=!0;break}}else if(n.childElementCount===0&&s){if(t&&t.hasOwnProperty(s)&&(t=t[s]),t=this.runDirectives(n,t),i&&this.applyEmbeddedDirectives(n,t,i)){this.log("directives applied to element, done.");return}if(typeof t=="undefined"){this.log("directives, but no data");return}n.tagName==="INPUT"?(e=n,e.type==="radio"||e.type==="checkbox"?e.value===t&&(this.log(e.type+".checked => true"),e.checked=!0):(this.log(e.type+".value => "+t),e.value=t)):n.tagName==="TEXTAREA"?(this.log("textarea => "+t),n.innerText=t):(this.log("innerHTML => "+t),n.innerHTML=t)}for(l=0;l<n.childElementCount;l++){if(f=n.children[l],r=this.getName(f),!r){this.renderElement(f,t,i);continue}if(u=t[r],o=null,i&&i.hasOwnProperty(r)&&(o=i[r]),typeof u=="undefined"&&(this.log("got no data, checking directives."),v=!1,o&&(v=o.hasOwnProperty("value")||o.hasOwnProperty("text")||o.hasOwnProperty("html")),!v)){this.log("got no data and no directives.");continue}if(this.isCollection(f))this.lineage.push(r),this.dtoStack.push(u),this.renderCollection(f,u,o),this.dtoStack.pop(),this.lineage.pop();else{if(f.getAttribute("data-unless")===r)u&&u.length>0&&(f.style.display="none");else if(u instanceof Array){y=document.createElement("div");y.appendChild(f.cloneNode(!0));p=y.innerHTML;w=r;this.lineage.length>0&&(w=this.lineage.join());throw"'"+r+"' is not set as a collection, but the data is an array.\nElement: "+p+"\nData: "+JSON.stringify(u,null,4);}this.lineage.push(r);this.dtoStack.push(u);this.renderElement(f,u,o);this.dtoStack.pop();this.lineage.pop()}}},n.prototype.renderCollection=function(n,t,i){var u=this,r,c,f,s,e,l;if(i===void 0&&(i=null),r=n,this.log("renderCollection"),n.hasAttribute("data-unless")){var h=n.getAttribute("data-unless"),a=this.getName(n),o=!1;a===h?o=t.length===0:(c={element:n,data:t,dto:this.dtoStack[this.dtoStack.length-2]},o=this.evalInContext(h,c));o?(this.log("unless(show)"),n.style.display=""):(this.log("unless(hide)"),n.style.display="none")}if((r.tagName==="TR"||r.tagName==="LI")&&(r=r.parentElement,this.log("correcting container element by moving to up to parent",r),r.setAttribute("data-collection",n.getAttribute("data-collection")),n.setAttribute("data-name","value"),n.removeAttribute("data-collection")),f=r.firstElementChild.cloneNode(!0),f.removeAttribute("data-template"),f.style.display="",!r.firstElementChild.hasAttribute("data-template")){if(r.childElementCount!==1)throw new Error("There must be a single child element in collection containers. If you use multiple elements you need to for instance wrap them in a div. Path: '"+this.lineage.join(" -> ")+"'.");s=r.firstElementChild;s.style.display="none";s.setAttribute("data-template","true")}while(r.childElementCount>1)r.removeChild(r.lastElementChild);e=0;l=t;l.forEach(function(n){var t=f.cloneNode(!0);u.lineage.push("["+e+"]");u.dtoStack.push(n);u.renderElement(t,n,i);u.lineage.pop();u.dtoStack.pop();e=e+1;r.appendChild(t)})},n.prototype.applyEmbeddedDirectives=function(n,t,i){var f=!1,r,u;for(r in i)u=i[r].apply(n,[t,this.dtoStack[this.dtoStack.length-2]]),r==="html"?(f=!0,this.log("Assigning html",u,"to",n),n.innerHTML=u):r==="text"?(f=!0,this.log("Assigning text",u,"to",n),n.innerText=u):(r==="value"&&(f=!0),this.log("Assigning",u,"to",n,"attribute",r),n.setAttribute(r,u));return f},n.prototype.runDirectives=function(t,i){var u=this,r={element:t,lineage:this.lineage,propertyName:this.lineage[this.lineage.length-1],value:i};return this.directives.forEach(function(n){if(!n.process(r))return u.log("Local directive ",n,"cancelled processing of",r),!1}),n.globalValueDirectives.forEach(function(n){if(!n.process(r))return u.log("Global directive ",n,"cancelled processing of",r),!1}),r.value},n.prototype.getName=function(n){return n.getAttribute("name")||n.getAttribute("data-name")||n.getAttribute("data-collection")||n.getAttribute("data-unless")},n.prototype.hasName=function(n){return n.hasAttribute("name")||n.hasAttribute("data-name")||n.hasAttribute("data-collection")||n.hasAttribute("data-unless")},n.prototype.isCollection=function(n){return n.hasAttribute("data-collection")},n.prototype.evalInContext=function(n,t){var i=function(n){return eval("with (this) { "+n+"}")};return i.call(t,n)},n.prototype.log=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];n.DEBUG&&console&&console.log&&(t.unshift(this.dtoStack[this.dtoStack.length-1]),this.lineage.length==0?t.unshift("rootNode"):t.unshift(this.lineage[this.lineage.length-1]),t.unshift(arguments.callee.caller.prototype),console.log.apply(console,t))},n}(),i;t.globalValueDirectives=[];t.DEBUG=!1;n.ViewRenderer=t;i=function(){function n(){}return n}();n.ViewValueDirectiveContext=i})(t=n.Views||(n.Views={}))})(t=n.Yo||(n.Yo={}))}(Griffin||(Griffin={})),function(n){var t;(function(n){var t=function(){function t(){}return t.render=function(t,i,r){var u=new n.Views.ViewRenderer(t);u.render(i,r)},t}();t.select=new n.Dom.Selector;t.handle=new n.Dom.EventMapper;n.G=t})(t=n.Yo||(n.Yo={}))}(Griffin||(Griffin={})),function(n){var t;(function(n){var t=function(){function n(){}return n}();t.applicationScope={};n.GlobalConfig=t;t.resourceLocator={getHtml:function(n){var t=window.location.pathname,i;return window.location.pathname.indexOf(".")>-1&&(i=window.location.pathname.lastIndexOf("/"),t=window.location.pathname.substr(0,i)),t.substring(-1,1)==="/"&&(t=t.substring(0,-1)),t+("/Views/"+n+".html")},getScript:function(n){var t=window.location.pathname,i;return window.location.pathname.indexOf(".")>-1&&(i=window.location.pathname.lastIndexOf("/"),t=window.location.pathname.substr(0,i)),t.substring(-1,1)==="/"&&(t=t.substring(0,-1)),t+("/ViewModels/"+n+"ViewModel.js")}};t.applicationScope={};t.viewModelFactory={create:function(i,r){var u=n.Spa.ViewModels.ClassFactory.getConstructor(i,r);return new u(t.applicationScope)}}})(t=n.Yo||(n.Yo={}))}(Griffin||(Griffin={}));